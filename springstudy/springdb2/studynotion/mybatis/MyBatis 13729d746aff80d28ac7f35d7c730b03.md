# MyBatis

- MyBatis ì†Œê°œ
- MyBatis ì„¤ì •
- MyBatis ì ìš©1 - ê¸°ë³¸
- MyBatis ì ìš©2 - ì„¤ì •ê³¼ ì‹¤í–‰
- MyBatis ì ìš©3 - ë¶„ì„
- MyBatis ê¸°ëŠ¥ ì •ë¦¬1 - ë™ì  ì¿¼ë¦¬
- MyBatis ê¸°ëŠ¥ ì •ë¦¬2 - ê¸°íƒ€ ê¸°ëŠ¥

## MyBatis ì†Œê°œ

`MyBatis`ëŠ” ì•ì„œ ì„¤ëª…í•œ `JdbcTemplate`ë³´ë‹¤ ë” ë§ì€ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” SQL Mapper ì´ë‹¤.
ê¸°ë³¸ì ìœ¼ë¡œ `JdbcTemplate`ì´ ì œê³µí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
`JdbcTemplate`ê³¼ ë¹„êµí•´ì„œ `MyBatis`ì˜ ê°€ì¥ ë§¤ë ¥ì ì¸ ì ì€ **SQLì„ XMLì— í¸ë¦¬í•˜ê²Œ ì‘ì„±**í•  ìˆ˜ ìˆê³  

ë˜ **ë™ì  ì¿¼ë¦¬ë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì‘ì„±**í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

ë¨¼ì € SQLì´ ì—¬ëŸ¬ì¤„ì— ê±¸ì³ ìˆì„ ë•Œ ë‘˜ì„ ë¹„êµí•´ë³´ì.

**JdbcTemplate - SQL ì—¬ëŸ¬ì¤„**

```java
String sql = "update item " +
"set item_name=:itemName, price=:price, quantity=:quantity " +
"where id=:id";
```

**MyBatis - SQL ì—¬ëŸ¬ì¤„**

```java
<update id="update">
	update item
	set item_name=#{itemName},
		price=#{price},
		quantity=#{quantity}
	where id = #{id}
</update>
```

MyBatisëŠ” XMLì— ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ë¼ì¸ì´ ê¸¸ì–´ì ¸ë„ ë¬¸ì ë”í•˜ê¸°ì— ëŒ€í•œ ë¶ˆí¸í•¨ì´ ì—†ë‹¤.

**MyBatis - ë™ì  ì¿¼ë¦¬**

```java
<select id="findAll" resultType="Item">
	select id, item_name, price, quantity
	from item
	<where>
		<if test="itemName != null and itemName != ''">
			and item_name like concat('%',#{itemName},'%')
		</if>
		<if test="maxPrice != null">
			and price &lt;= #{maxPrice}
		</if>
	</where>
</select>
```

JdbcTemplate ì€ ìë°” ì½”ë“œë¡œ ì§ì ‘ ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.

ë°˜ë©´ MyBatisëŠ” ë™ì  ì¿¼ë¦¬ë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•´ì¤€ë‹¤.

**ì„¤ì •ì˜ ì¥ë‹¨ì **

JdbcTemplateì€ ìŠ¤í”„ë§ì— ë‚´ì¥ëœ ê¸°ëŠ¥ì´ê³ , ë³„ë„ì˜ ì„¤ì •ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ë°˜ë©´ì— MyBatisëŠ” ì•½ê°„ì˜ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.

**ì •ë¦¬**

í”„ë¡œì íŠ¸ì—ì„œ ë™ì  ì¿¼ë¦¬ì™€ ë³µì¡í•œ ì¿¼ë¦¬ê°€ ë§ë‹¤ë©´ MyBatisë¥¼ ì‚¬ìš©í•˜ê³ , ë‹¨ìˆœí•œ ì¿¼ë¦¬ë“¤ì´ ë§ìœ¼ë©´ JdbcTemplateì„ ì„ íƒí•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

- **ê³µì‹** **ì‚¬ì´íŠ¸**

[https://mybatis.org/mybatis-3/ko/index.html](https://mybatis.org/mybatis-3/ko/index.html)

ê³µì‹ì‚¬ì´íŠ¸ê°€ í•œê¸€ë¡œ ì˜ ë²ˆì—­ë˜ì–´ ìˆì–´ì„œ, ì›í•˜ëŠ” ê¸°ëŠ¥ì„ í¸ë¦¬í•˜ê²Œ ì°¾ì•„ë³¼ ìˆ˜ ìˆë‹¤.

## MyBatis ì„¤ì •

`mybatis-spring-boot-starter` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ MyBatisë¥¼ ìŠ¤í”„ë§ê³¼ í†µí•©í•˜ê³ , ì„¤ì •ë„ ì•„ì£¼ ê°„ë‹¨íˆ í•  ìˆ˜ ìˆë‹¤.

**build.gradle ì˜ì¡´ê´€ê³„ ì¶”ê°€**

```java
//MyBatis ì¶”ê°€
implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3'
```

**main, test - application.properties**

```java
#MyBatis
mybatis.type-aliases-package=hello.itemservice.domain
mybatis.configuration.map-underscore-to-camel-case=true
logging.level.hello.itemservice.repository.mybatis=trace
```

- `mybatis.type-aliases-package`
    - ë§ˆì´ë°”í‹°ìŠ¤ì—ì„œ íƒ€ì… ì •ë³´ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” íŒ¨í‚¤ì§€ ì´ë¦„ì„ ì ì–´ì£¼ì–´ì•¼ í•˜ëŠ”ë°, ì—¬ê¸°ì— ëª…ì‹œí•˜ë©´ íŒ¨í‚¤ì§€ ì´ë¦„ì„ ìƒëµí•  ìˆ˜ ìˆë‹¤.
    - ì§€ì •í•œ íŒ¨í‚¤ì§€ì™€ ê·¸ í•˜ìœ„ íŒ¨í‚¤ì§€ê°€ ìë™ìœ¼ë¡œ ì¸ì‹ëœë‹¤.
    - ì—¬ëŸ¬ ìœ„ì¹˜ë¥¼ ì§€ì •í•˜ë ¤ë©´ `,` , `;`ë¡œ êµ¬ë¶„í•˜ë©´ ëœë‹¤.
- `mybatis.configuration.map-underscore-to-camel-case`
    - `JdbcTemplate`ì˜ `BeanPropertyRowMapper` ì—ì„œ ì²˜ëŸ¼ ì–¸ë”ë°”ë¥¼ ì¹´ë©œë¡œ ìë™ ë³€ê²½í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ í™œì„±í™” í•œë‹¤. ë°”ë¡œ ë‹¤ìŒì— ì„¤ëª…í•˜ëŠ” ê´€ë¡€ì˜ ë¶ˆì¼ì¹˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ì.
- `logging.level.hello.itemservice.repository.mybatis=trace`
    - MyBatisì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ê´€ë¡€ì˜ ë¶ˆì¼ì¹˜**

**ìë°” ê°ì²´ì—ëŠ” ì£¼ë¡œ ì¹´ë©œ í‘œê¸°ë²•**ì„ ì‚¬ìš©í•œë‹¤. itemName ì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” í‘œê¸°ë²•

**vs  snake í‘œê¸°ë²• : item_name**

â†’ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ì£¼ë¡œ ì–¸ë”ìŠ¤ì½”ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” snake_case ì‚¬ìš©í•˜ëŠ”ë°, í•´ë‹¹ 

`map-underscore-to-camel-case` ê¸°ëŠ¥ì„ í™œì„±í™” í•˜ë©´, ì–¸ë”ìŠ¤ì½”ì–´ í‘œê¸°ë²•ì„ ì¹´ë©œë¡œ ìë™ ë³€í™˜í•´ì¤€ë‹¤.

ë”°ë¼ì„œ DBì—ì„œ select item_name ìœ¼ë¡œ ì¡°íšŒí•´ë„, ê°ì²´ì˜ itemName(setItemName()) ì†ì„±ì— ê°’ì´ ì •ìƒ ì…ë ¥ ëœë‹¤.

**ë”°ë¼ì„œ, ì»¬ëŸ¼ ì´ë¦„ê³¼ ê°ì²´ ì´ë¦„ì´ ì™„ì „íˆ ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” ì¡°íšŒ SQL ì—ì„œ ë³„ì¹­ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.**

## MyBatis ì ìš© 1 - ê¸°ë³¸

**ItemMapper**

```java
package hello.itemservice.repository.mybatis;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;
import java.util.Optional;

@Mapper
public interface ItemMapper {
    void save(Item item);

    void update(@Param("id") Long id, @Param("updateParam") ItemUpdateDto updateDto);

    List<Item> findAll(ItemSearchCond itemSearchCond);

    Optional<Item> findById(Long id);
}
```

- MyBatis ë§¤í•‘ XML ì„ í˜¸ì¶œí•´ì£¼ëŠ” ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
- ì´ ì¸í„°í˜ì´ìŠ¤ëŠ” `@Mapper` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤. ê·¸ë˜ì•¼ `MyBatis` ì—ì„œ ì¸ì‹í•  ìˆ˜ ìˆë‹¤.
- ì´ ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´, xmlì˜ í•´ë‹¹ SQLì„ ì‹¤í–‰í•˜ê³ , ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.
- ItemMapper ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì— ëŒ€í•œ ë‚´ìš©ì€ ë’¤ì— ë³„ë„ë¡œ ë‚˜ì˜¬ ì˜ˆì •!

**XML FILE**
resources í•˜ìœ„ì— ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ìœ„ì¹˜í•˜ë©´ ë˜ëŠ”ë°,

resources í•˜ìœ„ì— ItemMapperì™€ ë™ì¼í•œ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ ì£¼ë©´ ëœë‹¤.

ì½”ë“œ ìƒë‹¨ì˜ package ë¥¼ í™•ì¸í•´ë³´ì.

```java
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hello.itemservice.repository.mybatis.ItemMapper">

    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        insert into item (item_name, price, quantity)
        values (#{itemName}, #{price}, #{quantity})
    </insert>

    <update id="update">
        update item
        set item_name=#{updateParam.itemName},
            price=#{updateParam.price},
            quantity=#{updateParam.quantity}
        where id = #{id}
    </update>

    <select id="findById" resultType="Item">
        select id, item_name, price, quantity
        from item
        where id = #{id}
    </select>

    <select id="findAll" resultType="Item">
        select id, item_name, price, quantity
        from item
        <where>
            <if test="itemName != null and itemName != ''">
                and item_name like concat('%', #{itemName}, '%')
            </if>
            <if test="maxPrice != null">
                and price &lt;= #{maxPrice}
            </if>
        </where>
    </select>

</mapper>
```

XML **íŠ¹ìˆ˜ë¬¸ì****

ê·¸ëŸ°ë° ê°€ê²©ì„ ë¹„êµí•˜ëŠ” ì¡°ê±´ì„ ë³´ì

`and price &lt;= #{maxPrice}`

ì—¬ê¸°ì— ë³´ë©´ `<=` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  `&lt;=` ë¥¼ ì‚¬ìš©í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê·¸ ì´ìœ ëŠ” XMLì—ì„œëŠ” ë°ì´í„° ì˜ì—­ì— `< , >` ê°™ì€ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ì´ìœ ëŠ” ê°„ë‹¨í•œë°, XMLì—ì„œ TAGê°€ ì‹œì‘í•˜ê±°ë‚˜ ì¢…ë£Œí•  ë•Œ `< , >` ì™€ ê°™ì€ íŠ¹ìˆ˜ë¬¸ìë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

`< : &lt;`

`> : &gt;`

`& : &amp;`

## MyBatis ì ìš© 2 - ì„¤ì •ê³¼ ì‹¤í–‰

---

**ğŸš¨Trouble Shooting**

ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ 3.x ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ì–´ì„œ

ë‹¹ì—°íˆ mybatis ë²„ì „ë„ ë§ì¶°ì•¼ í•œë‹¤ëŠ” ìƒê°ìœ¼ë¡œ 3.x.x ë²„ì „ì„ ì„ íƒí•˜ì˜€ëŠ”ë°, í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì‹¤íŒ¨í•¨.
`implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3'`
í•œì°¸ í—¤ë©”ë‹¤ê°€ ì™„ì „ ë°”ë³´ì§“ì„ í•˜ê³  ìˆì—ˆë‹¤â€¦

ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ëŠ” ê°•ì˜ì—ì„œ ì œê³µí•œ í”„ë¡œì íŠ¸ì´ê³ , í•´ë‹¹ í”„ë¡œì íŠ¸ ë²„ì „ì€ ìŠ¤í”„ë§ë¶€íŠ¸ 2.6.5 ì´ë‹¤.

ë”°ë¼ì„œ ë‹¤ì‹œ mybatis ë²„ì „ì„ 2.x ë¡œ ì„¤ì •í•˜ì˜€ìŒ.

`implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.3.2'`

ì„¤ì • ë¬¸ì œì¸ì§€ ë‹¤ì‹œ í™•ì¸í•˜ê³ , í•´ë‹¹ ë²„ì „ì´ ë¬´ì—‡ì¸ì§€ ì‚´í´ì•¼ê² ë‹¤.

---

**MyBatisConfig**

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.mybatis.ItemMapper;
import hello.itemservice.repository.mybatis.MyBatisItemRepository;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
@RequiredArgsConstructor
public class MyBatisConfig {

    private final ItemMapper itemMapper;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new MyBatisItemRepository(itemMapper);
    }

}
```

**MyBatisRepository**

```java
package hello.itemservice.repository.mybatis;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Slf4j
@Repository
@RequiredArgsConstructor
public class MyBatisItemRepository implements ItemRepository {

    private final ItemMapper itemMapper;

    @Override
    public Item save(Item item) {
        log.info("itemMapper class={}", itemMapper.getClass());
        itemMapper.save(item);
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        itemMapper.update(itemId, updateParam);
    }

    @Override
    public Optional<Item> findById(Long id) {
        return itemMapper.findById(id);
    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        return itemMapper.findAll(cond);
    }
}
```

ìœ„ë¥¼ ì‚´í´ë³´ë©´, `ItemMapper` ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.

ê·¸ëŸ¬ë‚˜ ìš°ë¦¬ê°€ `ItemMapper` ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì´ ì—†ë‹¤.

Config ì—ì„œë„ ê°ì²´ ìƒì„±ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤. ë‹¤ë§Œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ìƒì„±ì ì£¼ì…ë§Œ í•  ë¿.

ê·¸ëŸ¬ë©´ ì–´ë–»ê²Œ??? â†’

**ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ìë™ìœ¼ë¡œ ItemMapper ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ìë™ìœ¼ë¡œ ì£¼ì…í•´ì¤€ë‹¤.**

ì´í›„ í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ì •ìƒ ì‹¤í–‰ ë¨.

H2 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ê³  App ë„ ì‹¤í–‰ì´ ëœë‹¤.

## MyBatis ì ìš© 3 - ë¶„ì„

ItemMapper ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ê°€ ì—†ëŠ”ë° ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ” ê²ƒì¸ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì•Œì•„ë³´ì.

í•´ë‹¹ ë¶€ë¶„ì€ MyBatis ìŠ¤í”„ë§ ì—°ë™ ëª¨ë“ˆì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤€ë‹¤.

**ì„¤ì • ì›ë¦¬**

![image.png](MyBatis%2013729d746aff80d28ac7f35d7c730b03/image.png)

1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— MyBatis ìŠ¤í”„ë§ ì—°ë™ ëª¨ë“ˆì€ @Mapper ê°€ ë¶™ì–´ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¡°ì‚¬í•˜ê³ 
2. í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ê°€ ë°œê²¬ë˜ë©´ ë™ì  í”„ë¡ì‹œ ê¸°ìˆ ì„ ì‚¬ìš©í•´ì„œ ItemMapper ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ë§Œë“ ë‹¤
3. ìƒì„±ëœ êµ¬í˜„ì²´ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.

**ë¡œê·¸ë¥¼ í†µí•´ í™•ì¸ì„ í•´ ë³¸ ê²°ê³¼**

```java
itemMapper class=class jdk.proxy2.$Proxy70
```

## MyBatis ê¸°ëŠ¥ ì •ë¦¬ 1 - ë™ì  ì¿¼ë¦¬

**MyBatisì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” ê¸°ëŠ¥ì„ ê³µì‹ ë©”ë‰´ì–¼ì´ ì œê³µí•˜ëŠ” ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³´ì.**

- MyBatis ê³µì‹ ë©”ë‰´ì–¼: [https://mybatis.org/mybatis-3/ko/index.html](https://mybatis.org/mybatis-3/ko/index.html)
- MyBatis ìŠ¤í”„ë§ ê³µì‹ ë©”ë‰´ì–¼: [https://mybatis.org/spring/ko/index.html](https://mybatis.org/spring/ko/index.html)

**ê³µì‹ ë©”ë‰´ì–¼ì´ ì œê³µí•˜ëŠ” ë™ì  SQL ì˜ˆì œ**

**IF**

```java
<select id="findActiveBlogWithTitleLike"
	resultType="Blog">
SELECT * FROM BLOG
WHERE state = â€˜ACTIVEâ€™
<if test="title != null">
	AND title like #{title}
</if>
</select>
```

- í•´ë‹¹ ì¡°ê±´ì— ë”°ë¼ ê°’ì„ ì¶”ê°€í• ì§€ ê²°ì •í•œë‹¤.
- ë‚´ë¶€ ë¬¸ë²•ì€ OGNLì„ ì‚¬ìš©í•œë‹¤.

**choose, when, otherwise**

```java
<select id="findActiveBlogLike"
	resultType="Blog">
SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™
	<choose>
		<when test="title != null">
			AND title like #{title}
		</when>
		<when test="author != null and author.name != null">
			AND author_name like #{author.name}
		</when>
		<otherwise>
			AND featured = 1
		</otherwise>
	</choose>
</select>
```

- switch ë¬¸ê³¼ ìœ ì‚¬í•˜ê²Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

**`<where>` ì‚¬ìš©**

```java
<select id="findActiveBlogLike"
	resultType="Blog">
SELECT * FROM BLOG
	<where>
		<if test="state != null">
			state = #{state}
		</if>
		<if test="title != null">
			AND title like #{title}
		</if>
		<if test="author != null and author.name != null">
			AND author_name like #{author.name}
		</if>
	</where>
	</select>
```

`<where>` ëŠ” ë¬¸ì¥ì´ ì—†ìœ¼ë©´, whereë¥¼ ì¶”ê°€í•˜ì§€ ì•Šê³ , ë¬¸ì¥ì´ ìˆìœ¼ë©´, whereì„ ì¶”ê°€í•œë‹¤. ë§Œì•½, and ê°€ ë¨¼ì € ì‹œì‘ ëœë‹¤ë©´, AND ë¥¼ ì§€ì›Œì„œ ë¬¸ë²• ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•Šë„ë¡ í•œë‹¤.

## MyBatis ê¸°ëŠ¥ ì •ë¦¬ 2 - ê¸°íƒ€ ê¸°ëŠ¥

### ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ SQL ì‘ì„±

XML ëŒ€ì‹  ì• ë…¸í…Œì´ì…˜ì— SQLì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

- `@Insert` , `@Update` , `@Delete` , `@Select` ê¸°ëŠ¥ì´ ì œê³µëœë‹¤.

```java
@Select("select id, item_name, price, quantity from item where id=#{id}")
Optional<Item> findById(Long id);
```

â†’ ë™ì  SQL ì´ í•´ê²°ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ê°„ë‹¨í•œ ê²½ìš°ì—ë§Œ ì ìš© ê°€ëŠ¥í•˜ë‹¤.

### ë¬¸ìì—´ ëŒ€ì²´

`#{}` ë¬¸ë²•ì€ ?ë¥¼ ë„£ê³  íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”©í•˜ëŠ” `PreparedStatement` ë¥¼ ì‚¬ìš©í•œë‹¤.
ë•Œë¡œëŠ” íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì´ ì•„ë‹ˆë¼ ë¬¸ì ê·¸ëŒ€ë¡œë¥¼ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ê²½ìš°ë„ ìˆë‹¤. ì´ë•ŒëŠ” `${}` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```java
@Select("select * from user where ${column} = #{value}")
User findByColumn(@Param("column") String column, @Param("value") String value);
```

ğŸš¨Â SQL ì¸ì ì…˜ ê³µê²©ì„ ë‹¹í•  ìˆ˜ ìˆë‹¤. ì™œ? ë¬¸ìì—´ ê·¸ëŒ€ë¡œê°€ ë“¤ì–´ê°€ì„œ SQL ë¬¸ë²• ë‚´ì—ì„œ í•´ë‹¹ ì…ë ¥ê°’ì´ SQL ë¬¸ìœ¼ë¡œ DB ë¥¼ ì‘ë™ì‹œí‚¬ ìˆ˜ ìˆê¸° ë•Œë¬¸!!!

### ì¬ì‚¬ìš© ê°€ëŠ¥í•œ SQL ì¡°ê°

**<sql> ì„ ì‚¬ìš©í•˜ë©´ SQL ì½”ë“œë¥¼ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.**

### Result Maps

ê²°ê³¼ë¥¼ ë§¤í•‘í•  ë•Œ í…Œì´ë¸”ì€ user_id ì´ì§€ë§Œ, ê°ì²´ëŠ” idì´ë‹¤.

ì´ëŸ´ ê²½ìš° ì»¬ëŸ¼ëª…ê³¼ ê°ì²´ì˜ í”„ë¡œí¼í‹° ëª…ì´ ë‹¤ë¥´ë‹¤ ê·¸ëŸ¬ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³„ì¹­ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

â†’ as

```java
<select id="selectUsers" resultType="User">
	select
		user_id as "id",
		user_name as "userName",
		hashed_password as "hashedPassword"
	from some_table
	where id = #{id}
</select>
```

**ë³µì¡í•œ ê²°ê³¼ ë§¤í•‘**

MyBatis ë„ ë§¤ìš° ë³µì¡í•œ ê²°ê³¼ì— ê°ì²´ ì—°ê´€ê´€ê³„ë¥¼ ê³ ë ¤í•´ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.

í•˜ì§€ë§Œ ì´ ë¶€ë¶„ì€ ì„±ëŠ¥ê³¼ ì‹¤íš¨ì„± ì¸¡ë©´ì—ì„œ ë§ì€ ê³ ë¯¼ì´ í•„ìš”í•˜ë‹¤.

â†’ ë“¤ì–´ê°€ëŠ” ê³µìˆ˜ë„ ë§ê³ ,

â†’ ì„±ëŠ¥ì„ ìµœì í™” í•˜ê¸°ë„ ì–´ë µë‹¤.

ë”°ë¼ì„œ í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.